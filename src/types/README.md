# API Generated Types

This directory contains TypeScript types auto-generated from the OpenAPI specification.

## Files

- **`api-generated.ts`** - Auto-generated TypeScript interfaces from `docs/CuratorAI API.yaml`
  - **DO NOT EDIT THIS FILE MANUALLY**
  - This file is regenerated whenever the backend API specification changes

## Regenerating Types

When the backend updates the OpenAPI spec (`docs/CuratorAI API.yaml`), regenerate types:

```bash
npm run generate:types
```

This will overwrite `api-generated.ts` with the latest types from the API specification.

## Usage

### Importing Types

```typescript
import type { components } from '@/types/api-generated'

// Use schema types
type User = components['schemas']['User']
type LoginRequest = components['schemas']['LoginRequestRequest']
type LoginResponse = components['schemas']['LoginResponse']

// Error response types
type ValidationError = components['schemas']['ValidationErrorResponse']
type UnauthorizedError = components['schemas']['UnauthorizedErrorResponse']
```

### Using in API Calls

```typescript
import { apiClient } from '@/infrastructure/api/ApiClient'
import type { components } from '@/types/api-generated'

async function login(credentials: components['schemas']['LoginRequestRequest']) {
  const response = await apiClient.post<components['schemas']['LoginResponse']>(
    '/auth/login/',
    credentials
  )
  return response
}
```

### Error Handling

Use the API error handler utilities that work with generated types:

```typescript
import { extractAPIErrorMessage, extractValidationErrors } from '@/shared/utils/apiErrorHandler'

try {
  await login({ email, password })
} catch (error) {
  // Extract user-friendly error message
  const message = extractAPIErrorMessage(error, 'Login failed')
  showToast.error('Login Failed', message)

  // Get field-specific validation errors
  const fieldErrors = extractValidationErrors(error)
  if (fieldErrors) {
    // fieldErrors = { email: 'Invalid email', password: 'Too short' }
    Object.entries(fieldErrors).forEach(([field, msg]) => {
      console.log(`${field}: ${msg}`)
    })
  }
}
```

## Available Error Response Types

All backend error responses follow this structure:

```typescript
{
  success: false;
  error: {
    code: string;          // Error code (e.g., "VALIDATION_ERROR")
    message: string;       // User-friendly message
    details?: {            // For validation errors only
      [field: string]: string[];  // Field-specific errors
    };
    timestamp: string;     // ISO timestamp
  };
}
```

**Error Types:**

- `ValidationErrorResponse` (400) - Field validation errors
- `UnauthorizedErrorResponse` (401) - Authentication required
- `ForbiddenErrorResponse` (403) - Permission denied
- `NotFoundErrorResponse` (404) - Resource not found
- `ConflictErrorResponse` (409) - Resource conflict

## Benefits

✅ **Type Safety** - Compile-time validation of API requests/responses
✅ **Auto-completion** - IDE knows all available fields
✅ **Always in Sync** - Regenerate when backend changes
✅ **Single Source of Truth** - API spec is the contract
✅ **No Manual Maintenance** - No need to manually write/update interfaces

## Workflow

1. Backend team updates OpenAPI spec in `docs/CuratorAI API.yaml`
2. Frontend runs `npm run generate:types`
3. TypeScript compiler catches any breaking changes
4. Fix any type errors in frontend code
5. Deploy with confidence

## Type-Safe API Client (Future Enhancement)

Consider using `openapi-typescript-fetch` or `openapi-fetch` for a fully type-safe API client:

```typescript
import createClient from 'openapi-fetch'
import type { paths } from '@/types/api-generated'

const client = createClient<paths>({ baseUrl: 'https://api.curatorai.com' })

// Fully typed request and response!
const { data, error } = await client.POST('/api/v1/auth/login/', {
  body: {
    email: 'user@example.com',
    password: 'password',
  },
})

if (error) {
  // error is typed as ValidationErrorResponse | UnauthorizedErrorResponse
  console.log(error.error.message)
}

if (data) {
  // data is typed as LoginResponse
  console.log(data.user.email)
}
```
